<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <title>{$fsc->empresa->nombre}</title>
   <meta name="description" content="FacturaScripts es un software de facturación y contabilidad para pymes.
         Es software libre bajo licencia GNU/AGPL." />
   <meta name="keywords" content="facturascripts, facturación, contabilidad, abanq, eneboo, facturalux, facturaplus"/>
   <link rel="shortcut icon" href="img/favicon.ico" />
   <link rel="stylesheet" type="text/css" href="css/{$fsc->css_file}" />
   <script type="text/javascript" src="js/jquery.js"></script>
   <script type="text/javascript">
      $(document).ready(function() {
         {if condition="$demo"}
         document.f_login.user.focus();
         {else}
         document.f_login.password.focus();
         {/if}
      });
   </script>
   {if condition="$demo"}
   <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-417932-8']);
      _gaq.push(['_setDomainName', 'facturascripts.com']);
      _gaq.push(['_trackPageview']);
      (function() {
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
   </script>
   {/if}
</head>
<body>
   <div id="login_header">
      <form name="f_login" action="index.php?nlogin={$nlogin}" method="post">
      <table width="100%">
         <tr>
            <td>
               <a id="fs_logo2" href="index.php">
                  {if condition="$demo"}FacturaScripts{else}{$fsc->empresa->nombre}{/if}
               </a>
            </td>
            <td align="right">
               <div id="login_box">
               {if condition="$demo"}
                  Tu nombre:
                  <input type="text" name="user" size="12" maxlength="12" autocomplete="off"/>
                  <input type="hidden" name="password" value="demo"/>
                  &nbsp; <input type="submit" value="entrar"/>
               {else}
                  Usuario:
                  <select name="user">
                  {loop name="$fsc->user->all()"}
                     {if condition="$value->nick == $nlogin"}
                     <option value="{$value->nick}" selected>{$value->nick}</option>
                     {else}
                     <option value="{$value->nick}">{$value->nick}</option>
                     {/if}
                  {/loop}
                  </select>
                  &nbsp; Contraseña:
                  <input type="password" name="password" size="6" maxlength="20"/>
                  &nbsp; <input type="submit" value="entrar"/>
               {/if}
               </div>
            </td>
         </tr>
      </table>
      </form>
   </div>
   <div class="main_div">
      {if condition="$fsc->get_errors()"}
         <div class="error">
            <ul>{loop="$fsc->get_errors()"}<li>{$value}</li>{/loop}</ul>
         </div>
      {/if}
      {if condition="$fsc->get_messages()"}
         <div class="message">
            <ul>{loop="$fsc->get_messages()"}<li>{$value}</li>{/loop}</ul>
         </div>
      {/if}
      {if condition="$demo"}
         <div class="advice">
            Esto es una <b>demo</b>, por eso la seguridad está desactivada. Introduce tu nombre
            en el recuadro de arriba a la derecha para continuar.
         </div>
      {/if}
      <div class="rounded">
         <h1>Información importante:</h1>
         <table width="100%">
            <tr>
               <td>
                  <ul>
                     <li>
                        <a target="_blank" href='http://code.google.com/p/facturascripts/'>FacturaScripts</a>
                        es un software de facturación y contabilidad para pymes. Es compatible con Abanq o Eneboo,
                        y es software libre bajo licencia <a href='COPYING'>GNU/AGPL</a>.
                     </li>
                     <li>
                        Si tienes cualquier problema o sugerencia no dudes en
                        <a target="_blank" href="http://code.google.com/p/facturascripts/issues/list">reportar un error</a>.
                     </li>
                     <li>
                        Si quieres instalarlo en tu servidor lee este
                        <a target="_blank" href="http://neorazorx.blogspot.com/2012/03/primeros-pasos-con-facturascripts-09.html">
                        tutorial de instalación</a>.
                     </li>
                     <li>
                        Puedes seguir el desarrollo de FacturaScripts a través de mi
                        <a target="_blank" href="http://www.neorazorx.com">mi blog</a>,
                        mi twitter <a target="_blank" href="https://twitter.com/neorazorx">@neorazorx</a>
                        o la comunidad de
                        <a target="_blank" href="https://plus.google.com/communities/108290867709111243870">Google+</a>.
                     </li>
                  </ul>
               </td>
               {if condition="$demo"}
               <td valign="top" align="right">
                  <div id="fb-root"></div>
                  <div class="fb-like" data-send="true" data-layout="box_count" data-width="90" data-show-faces="false"></div>
                  <script>(function(d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0];
                    if (d.getElementById(id)) return;
                    js = d.createElement(s); js.id = id;
                    js.src = "//connect.facebook.net/es_ES/all.js#xfbml=1";
                    fjs.parentNode.insertBefore(js, fjs);
                  }(document, 'script', 'facebook-jssdk'));</script>
               </td>
               <td valign="top" align="right">
                  <a href="https://twitter.com/share" class="twitter-share-button" data-lang="es" data-count="vertical" data-related="neorazorx">Tweet</a>
                  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
               </td>
               <td valign="top" align="right">
                  <div class="g-plusone" data-size="tall"></div>
                  <script type="text/javascript">
                    window.___gcfg = {lang: 'es'};
                    (function() {
                      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                      po.src = 'https://apis.google.com/js/plusone.js';
                      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                    })();
                  </script>
               </td>
               {/if}
            </tr>
         </table>
      </div>
      {if condition="$demo"}
      <div class="advice">
         <table width="100%">
            <tr>
               <td valign="top">
                  <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
                     <input type="hidden" name="cmd" value="_s-xclick">
                     <input type="hidden" name="hosted_button_id" value="NXUH3XYDVPQBG">
                     <input type="image" src="https://www.paypalobjects.com/es_ES/ES/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal. La forma rápida y segura de pagar en Internet.">
                     <img alt="" border="0" src="https://www.paypalobjects.com/es_ES/i/scr/pixel.gif" width="1" height="1">
                  </form>
               </td>
               <td valign="top">
                  Es triste de pedir, pero más triste es de robar ... si quieres ayudar a este proyecto lo tienes muy fácil.
                  ¿Para qué es el dinero? para mantenimiento del servidor y para comprar el material necesario para probar
                  nuevas características: impresora de tickets, caja y lcd para probar el TPV, una tablet para mejorar
                  la hoja de estilos touch, etc...
               </td>
            </tr>
         </table>
      </div>
      {/if}
      <div class="rounded">
         <h1>Novedades:</h1>
         <ul>
            <li>
               21/03/2013:
               <ul>
                  <li>Modificado el formulario de nuevo asiento para hacerlo más sencillo.</li>
                  <li>
                     Añadidos botones de reimprimir ticket y abrir caja al formulario "TPV > Genérico".
                     Además, en las búsquedas, ahora incluye el enlace [+] para ver los precios del artículo
                     y el enlace de la referencia para añadir el artículo directamente.
                  </li>
               </ul>
            </li>
            <li>
               18/03/2013:
               <ul>
                  <li>
                     Añadido formulario de divisas (<a target="_blank" href="https://code.google.com/p/facturascripts/issues/detail?id=16">issue 16</a>).
                  </li>
               </ul>
            </li>
            <li>
               16/03/2013:
               <ul>
                  <li>Añadido redondeo a la hora de crear/modificar albaranes.</li>
                  <li>
                     Ya se pueden cerrar correctamente los ejercicios. Desde la página del ejercicio,
                     si este está abierto, pulsas el botón "cerrar ejercicio" y se generarán los
                     asientos de regularización, cierre y apertura del ejercicio siguiente.
                  </li>
                  <li>Corregida la forma de actualizar los saldos de las subcuentas.</li>
                  <li>
                     Nueva función floatcmp($f1, $f2, precision=10) para comparar números
                     en coma flotante.
                  </li>
               </ul>
            </li>
            <li>
               27/02/2013:
               <ul>
                  <li>
                     Eliminado el código para corregir asientos y partidas ya que los descuadres detectados
                     se debían a que los saldos de las subcuentas estaban desactualizados, problema que ya
                     ha sido solucionado.
                  </li>
               </ul>
            </li>
            <li>
               26/02/2013:
               <ul>
                  <li>Solucionado el bug que permitía crear albaranes en ejercicios ya cerrados.</li>
                  <li>
                     Mejorado el asistente de creación de albaranes. Ahora cuando se hace una búsqueda
                     se muestra para cada artículo un enlace [+] para ver los precios de compra/venta,
                     y el enlace para añadir directamente el artículo a la lista.
                  </li>
               </ul>
            </li>
            <li>
               25/02/2013:
               <ul>
                  <li>
                     En el modo demo ahora se crea un usuario para cada visitante, en función de
                     su nombre real. Además se han establecido una serie de limitaciones al modo demo
                     para evitar malas prácticas (no se pueden eliminar agentes o usuarios,
                     no se pueden desactivar páginas).
                  </li>
                  <li>
                     El menú de usuario ahora añade enlaces a tu usuario y a tu agente.
                  </li>
                  <li>
                     Nueva clase fs_printer para unificar la gestión de impresión. Ahora se puede
                     imprimir tanto por cups como directamente volcando los datos al puerto de
                     la impresora. La impresora se define mediante la constante FS_PRINTER. El LCD
                     se trata como a una impresora, y se define mediante la constante FS_LCD.
                  </li>
                  <li>"General > Familias" ya permite buscar.</li>
                  <li>
                     Generación y asignación de ejercicio automática:
                     A la hora de crear albaranes ya no se necesita especificar el ejercicio,
                     ahora se selecciona el ejercicio en función de la fecha del albarán. Si no hay
                     ningún ejercicio para una fecha e concreto, se crea un ejercicio nuevo automáticamente.
                  </li>
                  <li>
                     "Admin > agentes > agente" añade ahora un listado de cajas del usuario.
                  </li>
                  <li>
                     "TPV > TPV_recambios" es ahora "TPV > genérico" y "TPV > TPV_yamyam" es ahora
                     "TPV > Restaurante".
                  </li>
                  <li>
                     Ya se pueden generar asientos desde la página de la factura.
                  </li>
                  <li>
                     El asistente de creación de albaranes muestra ahora una ventana con todos los
                     datos de venta del artículo seleccionado en la ventana de búsqueda.
                  </li>
                  <li>
                     La página de cada ejercicio hace un chequeo completo del ejercicio para informarnos de
                     posibles descuadres.
                  </li>
                  <li>
                     "Admin > Información del sistema > errores" ahora inicia un proceso de búsqueda de
                     errores en asientos y facturas.
                  </li>
                  <li>
                     El proceso de cron ahora recalcula los saldos de las subcuentas cada hora, y detecta mejor
                     los cambios para generar su libro mayor asociado.
                  </li>
               </ul>
            </li>
            <li>
               02/02/2013:
               <ul>
                  <li>
                     La clase fs_cache ahora se guarda el mensaje de error de conexión o clase memcache no encontrada,
                     así es mucho más sencillo detectar problemas de instalación.
                     También se ha añadido la función version().
                  </li>
                  <li>La versión de memcache ya se muestra desde "Admin > información del sistema".</li>
                  <li>
                     La página "Admin > Tabla a XML" ahora detecta columnas de tipo serial (en lugar de detectarlas
                     como simples enteros). Las columnas se ordenan alfabéticamente y las restricciones ahora
                     incluyen el tipo.
                  </li>
                  <li>
                     Añadido soporte para el LCD Glancetron 8035 en "TPV > TPV_yamyam".
                  </li>
               </ul>
            </li>
            <li>
               30/01/2013: Agrupar albaranes:
               <ul>
                  <li>
                     Solucionado el bug que hacía que se marcase la casilla 'generar facturas individuales'
                     por error al pulsar el botón marcar todo.
                  </li>
                  <li>Ahora recuerda el último cliente/proveedor.</li>
               </ul>
            </li>
            <li>
               29/01/2013:
               <ul>
                  <li>
                     Añadida comprobación para que el fallo en Memcache muestre un error.
                     Ahora FacturaScripts puede funcionar sin Memcache, excepto para las operaciones
                     donde sea imprescindible.
                  </li>
                  <li>
                     Ahora se muestra un error y finaliza si se comprueba que no se pueda escribir
                     en el directorio temporal.
                  </li>
                  <li>
                     Con estos cambios será más sencillo desplegar FacturaScripts sobre entornos
                     poco amigables para los desarrolladores web como Windows.
                  </li>
                  <li>
                     Las páginas de agrupar albaranes ahora también permiten generar facturas
                     individuales para cada albarán ¿Para qué? Pues para poder facturar un montón
                     de albaranes de una sola pasada.
                  </li>
               </ul>
            </li>
            <li>
               28/01/2013:
               <ul>
                  <li>El menú desplegable de usuarios ya se adapata al ancho de la página.</li>
                  <li>
                     Mejorados los formulario de admin_paginas, admin_usuario, contibilidad_subcuenta,
                     general_agrupar_albaranes_cli y general_agrupar_albaranes_pro. Añadidos botones para marcar
                     o desmarcar todas las casillas con un solo clic.
                  </li>
                  <li>
                     Añadidos botones de guardar en la parte inferior de los formularios de albaranes de clientes
                     y proveedores.
                  </li>
                  <li>
                     La página Informes > Facturas ahora permite especificar las fecha desde y hasta para
                     seleccionar las facturas correspondientes.
                  </li>
               </ul>
            </li>
            <li>
               19/01/2013:
               <ul>
                  <li>
                     Las páginas de albaranes ya permiten modificar el impuesto de cada línea. Además los
                     algoritmos para recalcular los totales y totales+iva de las líneas ahora modifican el
                     pvp cuando el descuento precalculado es negativo.
                  </li>
                  <li>
                     Se incluye un archivo interno con los datos de balances, grupos, epígrafes, cuentas
                     y subcuentas de un ejercicio estándar.
                  </li>
                  <li>Solucionado el bug que impedía limpiar búsquedas antiguas de artículos.</li>
               </ul>
            </li>
            <li>
               10/01/2013:
               <ul>
                  <li>
                     La página "contabilidad > ejercicios > ejercicio" ahora permite modificar la
                     longitud de las subcuentas. También muestra enlaces a los asientos de apertura,
                     cierre y pédidas y ganancias. Y el proceso de importación ahora genera también
                     las subcuentas para cada cliente y para proveedores.
                  </li>
               </ul>
            </li>
            <li>
               09/01/2013:
               <ul>
                  <li>
                     Ya se pueden exportar e importar todos los datos de un ejercicio (balances,
                     grupos, epígrafes, cuentas, cuentas especiales y subcuentas) desde la página
                     del ejercicio. Así como visualizar sus grupos, epígrafes, cuentas y subcuentas.
                  </li>
                  <li>La página de "contabilidad > cuentas" ahora muestra las cuentas especiales también.</li>
                  <li>Nueva página "contabilidad > balances". Y nueva página para cada balance.</li>
                  <li>Nuevos modelos: balance_cuentas, balance_cuentas_a y cuentas_especial.</li>
                  <li>Nuevas funciones fs_db::nextval() y fs_db::lastval().</li>
                  <li>Mejorado el algoritmo de comprobación de las tablas en la clase fs_model.</li>
                  <li>
                     Nueva clase fs_default_items para asignar los elementos por defecto de la sesión:
                     página de inicio, ejercicio, serie, forma de pago, etc...
                  </li>
                  <li>Mejorada la compatibilidad con los módulo oficiales de eneboo.</li>
               </ul>
            </li>
            <li>
               01/01/2013:
               <ul>
                  <li>
                     La página por defecto del usuario se guarda ahora en la base de datos,
                     al igual que el ejercicio por defecto.
                  </li>
                  <li>Mejorada la presentación de albaranes y facturas.</li>
                  <li>Nuevos modelos: epigrafe y grupo_epigrafes.</li>
                  <li>Ahora cada ejercicio tiene su página.</li>
                  <li>
                     Modificado el script de nuevo asiento para hacerlo más sencillo y
                     permitir calcular e introducir el iva y la base imponible de la contrapartida.
                  </li>
                  <li>
                     Solucionado el fallo en la función test() del modelo artículo que devuelve un error
                     con las descripciones de más de 100 caracteres en lugar de simplemente acortarlas.
                  </li>
                  <li>
                     Solucionado el fallo del script importar_familia que hacía que el script continuase
                     incluso aunque se produjeran errores.
                  </li>
               </ul>
            </li>
         </ul>
      </div>
      {if condition="$db_history"}
      <div id="sql_history">
         <h1>Consultas SQL:</h1>
         <ol>{loop="$fsc->get_db_history()"}<li>{$value}</li>{/loop}</ol>
      </div>
      {/if}
   </div>
   <div class="footer">
      <table>
         <tr>
            <td class="left">
               CSS:
               {if condition="$fsc->css_file=='base.css'"}
                  <a class="selected" href="{$fsc->url()}&css_file=base.css">normal</a> |
                  <a href="{$fsc->url()}&css_file=touch.css">touch</a>
               {else}
                  <a href="{$fsc->url()}&css_file=base.css">normal</a> |
                  <a class="selected" href="{$fsc->url()}&css_file=touch.css">touch</a>
               {/if}
            </td>
            <td class="right">
               Consultas: {$fsc->selects()} |
               Transacciones: {$fsc->transactions()} |
               Tiempo de ejecución: {$fsc->duration()}
            </td>
         </tr>
      </table>
   </div>
</body>
</html>