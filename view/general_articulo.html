{include="header"}

{if condition="$fsc->articulo"}
<script type="text/javascript">
   $(document).ready(function() {
      $("#b_eliminar_articulo").click(function(event) {
         event.preventDefault();
         if( confirm("¿Estas seguro de que deseas eliminar este articulo?") )
         window.location.href = "{$fsc->ppage->url()}&delete={$fsc->articulo->referencia}";
      });
      $("#b_imagen").click(function(event) {
         event.preventDefault();
         $("#shadow").show();
         $("#popup_articulo_imagen").css({
            left: ($(window).width() - $("#popup_articulo_imagen").outerWidth())/2,
            top: ($(window).height() - $("#popup_articulo_imagen").outerHeight())/2
         });
         $("#popup_articulo_imagen").show();
      });
      $("#b_paquete").click(function(event) {
         event.preventDefault();
         $("#shadow").show();
         $("#popup_paquete").css({
            left: ($(window).width() - $("#popup_paquete").outerWidth())/2,
            top: ($(window).height() - $("#popup_paquete").outerHeight())/2
         });
         $("#popup_paquete").show();
      });
   });
</script>

<div class="rounded">
   <form action="{$fsc->url()}" method="post">
      <h1>
         {$fsc->articulo->descripcion}
         <span>
            {if condition="$fsc->articulo->bloqueado"}
            <input type="checkbox" name="bloqueado" value="TRUE" checked="checked" id="articulo_bloqueado"/>
            {else}
            <input type="checkbox" name="bloqueado" value="TRUE" id="articulo_bloqueado"/>
            {/if}
            <label for="articulo_bloqueado">bloqueado</label>
         </span>
      </h1>
      <input type="hidden" name="referencia" value="{$fsc->articulo->referencia}"/>
      <div class="bloque">
         Descripción:
         <input type="text" name="descripcion" value="{$fsc->articulo->descripcion}" size="60"/>
      </div>
      <div class="bloque">
         <a href="{$fsc->familia->url()}">Familia</a>:
         <select name="codfamilia">
         {loop="$fsc->familia->all()"}
            {if condition="$value->codfamilia==$fsc->articulo->codfamilia"}
               <option value="{$value->codfamilia}" selected="selected">{$value->descripcion}</option>
            {else}
               <option value="{$value->codfamilia}">{$value->descripcion}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div class="bloque">Código de barras: <input type="text" name="codbarras" value="{$fsc->articulo->codbarras}"/></div>
      <div>
         Código de equivalencia:
         <input type="text" name="equivalencia" value="{$fsc->articulo->equivalencia}"/>
         Dos o más artículos son equivalentes si tienen el mismo código de equivalencia.
         <div class="bloque">
         {if condition="$fsc->articulo->destacado"}
            <input type="checkbox" name="destacado" value="TRUE" checked="checked" id="articulo_destacado"/>
         {else}
            <input type="checkbox" name="destacado" value="TRUE" id="articulo_destacado"/>
         {/if}
         <label for="articulo_destacado">Destacar frente a productos equivalentes</label>
         </div>
      </div>
      <div>
         <div class="bloque">
            IVA:
            <select name="codimpuesto">
            {loop="$fsc->impuesto->all()"}
               {if condition="$value->codimpuesto==$fsc->articulo->codimpuesto"}
               <option value="{$value->codimpuesto}" selected="selected">{$value->descripcion}</option>
               {else}
               <option value="{$value->codimpuesto}">{$value->descripcion}</option>
               {/if}
            {/loop}
            </select>
         </div>
         <div class="bloque">PVP: <input type="text" name="pvp" value="{$fsc->articulo->pvp}" size="5"/></div>
         <div class="bloque">PVP+IVA ({$fsc->articulo->show_pvp_iva()}): <input type="text" name="pvp_iva" value="" size="5"/></div>
         <div class="bloque">Actualizado: {$fsc->articulo->show_factualizado()}</div>
         <div class="bloque">
            {if condition="$fsc->articulo->secompra"}
            <input type="checkbox" name="secompra" value="TRUE" checked="checked" id="articulo_secompra"/>
            {else}
            <input type="checkbox" name="secompra" value="TRUE" id="articulo_secompra"/>
            {/if}
            <label for="articulo_secompra">se compra</label>
         </div>
         <div class="bloque">
            {if condition="$fsc->articulo->sevende"}
            <input type="checkbox" name="sevende" value="TRUE" checked="checked" id="articulo_sevende"/>
            {else}
            <input type="checkbox" name="sevende" value="TRUE" id="articulo_sevende"/>
            {/if}
            <label for="articulo_sevende">Se vende</label>
         </div>
      </div>
      <div>Observaciones:<br/><textarea name="observaciones" cols="60">{$fsc->articulo->observaciones}</textarea></div>
      <div>
         <div class="bloque">Stock: <input type="text" name="stockfis" value="{$fsc->articulo->stockfis}" size="5" disabled="disabled"/></div>
         <div class="bloque">Stock mínimo: <input type="text" name="stockmin" value="{$fsc->articulo->stockmin}" size="5"/></div>
         <div class="bloque">Stock máximo: <input type="text" name="stockmax" value="{$fsc->articulo->stockmax}" size="5"/></div>
         <div class="bloque">
            {if condition="$fsc->articulo->controlstock"}
            <input type="checkbox" name="controlstock" value="TRUE" checked="checked" id="articulo_controlstock"/>
            {else}
            <input type="checkbox" name="controlstock" value="TRUE" id="articulo_controlstock"/>
            {/if}
            <label for="articulo_controlstock">Permitir ventas sin stock</label>
         </div>
         <div class="right"><input type="submit" value="modificar"/></div>
      </div>
   </form>
</div>

<div class="rounded">
   <table class="list">
      <tr>
         <th>Almacén</th>
         <th>Nombre</th>
         <th align="right">Cantidad</th>
         <th align="right">Reservada</th>
         <th align="right">Disponible</th>
         <th align="right">Pendiente de recibir</th>
      </tr>
      {loop="$fsc->articulo->get_stock()"}
      <tr>
         <td>{$value->codalmacen}</td>
         <td>{$value->nombre}</td>
         <td align="right">{$value->cantidad}</td>
         <td align="right">{$value->reservada}</td>
         <td align="right">{$value->disponible}</td>
         <td align="right">{$value->pterecibir}</td>
      </tr>
      {/loop}
   </table>
</div>

<div class="popup" id="popup_paquete">
   <h1>Paquetes</h1>
   Si lo desdeas puedes convertir este artículo en un paquete o subpaquete:
   <a href="{$fsc->cache_paquete->add_url($fsc->articulo->referencia)}">añadir a la cesta de paquetes/subpaquetes</a>.
</div>

<div class="popup" id="popup_articulo_imagen">
   <h1>Imagen:</h1>
   Selecciona una imagen en formato PNG de tamaño inferior a 1MB.<br/>
   {if condition="$fsc->articulo->imagen_url()"}
      <center><img src="{$fsc->articulo->imagen_url()}" alt="{$fsc->articulo->referencia}"/></center>
   {/if}
   <form action="{$fsc->url()}" enctype="multipart/form-data" method="post">
      <input type="hidden" name="referencia" value="{$fsc->articulo->referencia}"/>
      <input type="hidden" name="imagen" value="TRUE"/>
      <input type="file" name="fimagen" accept="image/png"/>
      <input type="submit" value="guardar"/>
   </form>
</div>
{/if}

{include="footer"}