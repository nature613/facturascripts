{include="header"}

{if condition="$fsc->agente"}
<script type="text/javascript">
   function comprobar_url()
   {
      $("#panel_generales").hide();
      $("#panel_alb_cli").hide();
      $("#panel_alb_pro").hide();
      $("#panel_caja").hide();
      $("#ul_paginador").hide();
      $("#b_generales").removeClass('active');
      $("#b_alb_cli").removeClass('active');
      $("#b_alb_pro").removeClass('active');
      $("#b_caja").removeClass('active');
      
      if(window.location.hash.substring(1) == 'alb_cli')
      {
         $("#panel_alb_cli").show();
         $("#ul_paginador").show();
         $("#b_alb_cli").addClass('active');
      }
      else if(window.location.hash.substring(1) == 'alb_pro')
      {
         $("#panel_alb_pro").show();
         $("#ul_paginador").show();
         $("#b_alb_pro").addClass('active');
      }
      else if(window.location.hash.substring(1) == 'caja')
      {
         $("#panel_caja").show();
         $("#ul_paginador").show();
         $("#b_caja").addClass('active');
      }
      else
      {
         $("#panel_generales").show();
         $("#b_generales").addClass('active');
      }
   }
   $(document).ready(function() {
      comprobar_url();
      window.onpopstate = function(){ 
         comprobar_url();
      }
      $("#b_delete_agente").click(function(event) {
         event.preventDefault();
         if( confirm("¿Realmente desea eliminar el agente?") )
            window.location.href = '{$fsc->ppage->url()}&delete={$fsc->agente->codagente}';
      });
   });
</script>

<div class="container-fluid">
   <div class="row">
      <div class="col-lg-2">
         <div class="list-group">
            <a id="b_generales" href="{$fsc->url()}" class="list-group-item active">
               <span class="glyphicon glyphicon-dashboard"></span>
               &nbsp; Datos generales
            </a>
            <a id="b_alb_cli" href="{$fsc->url()}&listar=albaranes_cli#alb_cli" class="list-group-item">
               <span class="glyphicon glyphicon-list"></span>
               &nbsp; {$albaranes} de cliente
            </a>
            <a id="b_alb_pro" href="{$fsc->url()}&listar=albaranes_prov#alb_pro" class="list-group-item">
               <span class="glyphicon glyphicon-list"></span>
               &nbsp; {$albaranes} de proveedor
            </a>
            <a id="b_caja" href="{$fsc->url()}&listar=caja#caja" class="list-group-item">
               <span class="glyphicon glyphicon-euro"></span>
               &nbsp; Caja
            </a>
         </div>
      </div>
      
      <div class="col-lg-10">
         <form class="form" role="form" action="{$fsc->url()}" method="post">
            <div class="panel panel-primary" id="panel_generales">
               <div class="panel-heading">
                  <h3 class="panel-title">{$fsc->agente->get_fullname()}</h3>
               </div>
               <div class="panel-body">
                  <div class="form-group col-lg-6">
                     Nombre:
                     <input class="form-control" type="text" name="nombre" value="{$fsc->agente->nombre}" autocomplete="off"/>
                  </div>
                  <div class="form-group col-lg-6">
                     Apellidos:
                     <input class="form-control" type="text" name="apellidos" value="{$fsc->agente->apellidos}" autocomplete="off"/>
                  </div>
                  <div class="form-group col-lg-6">
                     DNI/CIF:
                     <input class="form-control" type="text" name="dnicif" value="{$fsc->agente->dnicif}" autocomplete="off"/>
                  </div>
                  <div class="form-group col-lg-6">
                     Teléfono:
                     <input class="form-control" type="text" name="telefono" value="{$fsc->agente->telefono}" autocomplete="off"/>
                  </div>
                  <div class="form-group col-lg-9">
                     Email:
                     <input class="form-control" type="text" name="email" value="{$fsc->agente->email}" autocomplete="off"/>
                  </div>
                  <div class="form-group col-lg-3">
                     % Comisión:
                     <input class="form-control" type="text" name="porcomision" value="{$fsc->agente->porcomision}" autocomplete="off"/>
                  </div>
               </div>
               <div class="panel-footer" style="text-align: right;">
                  <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled=true;this.form.submit();" title="Guardar" value="Guardar">
                     <span class="glyphicon glyphicon-floppy-disk"></span>
                     &nbsp; Guardar
                  </button>
               </div>
            </div>
         </form>
         
         <div class="table-responsive">
            {if condition="$fsc->listar=='albaranes_cli'"}
            <table class="table table-hover" id="panel_alb_cli">
               <thead>
                  <tr>
                     <th></th>
                     <th align="left">Código + Número 2</th>
                     <th align="left">Cliente</th>
                     <th align="left">Observaciones</th>
                     <th align="right">Total</th>
                     <th align="right">Fecha</th>
                  </tr>
               </thead>
               {loop="$fsc->listado"}
               <tr>
                  <td align="center">
                     {if condition="!$value->ptefactura"}
                     <span class="glyphicon glyphicon-paperclip" title="facturado"></span>
                     {/if}
                  </td>
                  <td><a href="{$value->url()}">{$value->codigo}</a> {$value->numero2}</td>
                  <td>{$value->nombrecliente}</td>
                  <td>{$value->observaciones_resume()}</td>
                  <td align="right">{$fsc->show_precio($value->total, $value->coddivisa)}</td>
                  <td align="right">{$value->fecha}</td>
               </tr>
               {else}
               <tr><td colspan="6" align="center">Ningún {$albaran} encontrado</td></tr>
               {/loop}
            </table>
            {elseif condition="$fsc->listar=='albaranes_prov'"}
            <table class="table table-hover" id="panel_alb_pro">
               <thead>
                  <tr>
                     <th></th>
                     <th align="left">Código + Núm. Proveedor</th>
                     <th align="left">Proveedor</th>
                     <th align="left">Observaciones</th>
                     <th align="right">Total</th>
                     <th align="right">Fecha</th>
                  </tr>
               </thead>
               {loop="$fsc->listado"}
               <tr>
                  <td align="center">
                     {if condition="!$value->ptefactura"}
                     <span class="glyphicon glyphicon-paperclip" title="facturado"></span>
                     {/if}
                  </td>
                  <td><a href="{$value->url()}">{$value->codigo}</a> {$value->numproveedor}</td>
                  <td>{$value->nombre}</td>
                  <td>{$value->observaciones_resume()}</td>
                  <td align="right">{$fsc->show_precio($value->total, $value->coddivisa)}</td>
                  <td align="right">{$value->fecha}</td>
               </tr>
               {else}
               <tr><td colspan="6" align="center">Ningún {$albaran} encontrado</td></tr>
               {/loop}
            </table>
            {else}
            <table class="table table-hover" id="panel_caja">
               <thead>
                  <tr>
                     <th>Caja</th>
                     <th>Fecha inicial</th>
                     <th align="right">Dinero inicial</th>
                     <th>Fecha fin</th>
                     <th align="right">Diferencia</th>
                     <th align="right">Tickets</th>
                  </tr>
               </thead>
               {loop="$fsc->listado"}
               <tr>
                  <td align="center">{$value->fs_id}</td>
                  <td align="center">{$value->fecha_inicial}</td>
                  <td align="right">{$fsc->show_precio($value->dinero_inicial)}</td>
                  <td align="center">{$value->show_fecha_fin()}</td>
                  <td align="right">{$fsc->show_precio($value->diferencia())}</td>
                  <td align="right">{$value->tickets}</td>
               </tr>
               {else}
               <tr><td colspan="6" align="center">No hay datos</td></tr>
               {/loop}
            </table>
            {/if}
         </div>
         <ul class="pager" id="ul_paginador">
            {if condition="$fsc->anterior_url()!=''"}
            <li class="previous">
               {if condition="$fsc->listar=='albaranes_cli'"}
               <a href="{$fsc->anterior_url()}#alb_cli">
                  <span class="glyphicon glyphicon-chevron-left"></span>
                  Anteriores
               </a>
               {elseif condition="$fsc->listar=='albaranes_prov'"}
               <a href="{$fsc->anterior_url()}#alb_pro">
                  <span class="glyphicon glyphicon-chevron-left"></span>
                  Anteriores
               </a>
               {else}
               <a href="{$fsc->anterior_url()}#caja">
                  <span class="glyphicon glyphicon-chevron-left"></span>
                  Anteriores
               </a>
               {/if}
            </li>
            {/if}
            {if condition="$fsc->siguiente_url()!=''"}
            <li class="next">
               {if condition="$fsc->listar=='albaranes_cli'"}
               <a href="{$fsc->siguiente_url()}#alb_cli">
                  Siguientes
                  <span class="glyphicon glyphicon-chevron-right"></span>
               </a>
               {elseif condition="$fsc->listar=='albaranes_prov'"}
               <a href="{$fsc->siguiente_url()}#alb_pro">
                  Siguientes
                  <span class="glyphicon glyphicon-chevron-right"></span>
               </a>
               {else}
               <a href="{$fsc->siguiente_url()}#caja">
                  Siguientes
                  <span class="glyphicon glyphicon-chevron-right"></span>
               </a>
               {/if}
            </li>
            {/if}
         </ul>
      </div>
   </div>
</div>
{else}
<div class="well well-sm" style="text-align: center;">
   <img src="view/img/fuuu_face.png" alt="fuuuuu"/>
</div>
{/if}

{include="footer"}
