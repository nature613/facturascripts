{include="header"}

<script type="text/javascript">
   function buscar_subcuentas()
   {
      if(document.f_buscar_subcuentas.query.value == '')
      {
         $("#subcuentas").html('');
      }
      else
      {
         var datos = 'query='+document.f_buscar_subcuentas.query.value;
         datos += "&ejercicio="+document.f_change_subcuenta.codejercicio.value;
         $.ajax({
            type: 'POST',
            url: '{$fsc->url()}',
            dataType: 'html',
            data: datos,
            success: function(datos) {
               var re = /<!--(.*?)-->/g;
               var m = re.exec( datos );
               if( m[1] == document.f_buscar_subcuentas.query.value )
               {
                  $("#subcuentas").html(datos);
               }
            }
         });
      }
   }
   function select_subcuenta(id,ejercicio,subcuenta,descripcion,debe,haber,saldo)
   {
      document.f_change_subcuenta.idsc2.value = id;
      document.f_change_subcuenta.codejercicio.value = ejercicio;
      document.f_change_subcuenta.codsubcuenta.value = subcuenta;
      document.f_change_subcuenta.descripcion.value = descripcion;
      document.f_change_subcuenta.debe.value = debe;
      document.f_change_subcuenta.haber.value = haber;
      document.f_change_subcuenta.saldo.value = saldo;
      $("#modal_subcuentas").modal('hide');
   }
   $(document).ready(function() {
      $("#codsubcuenta").click(function() {
         $("#subcuentas").html('');
         document.f_buscar_subcuentas.query.value = '';
         $("#modal_subcuentas").modal('show');
         document.f_buscar_subcuentas.query.focus();
      });
      $("#f_buscar_subcuentas").keyup(function() {
         buscar_subcuentas();
      });
      $("#f_buscar_subcuentas").submit(function(event) {
         event.preventDefault();
         buscar_subcuentas();
      });
   });
</script>

<div class="modal fade" id="modal_subcuentas">
   <div class="modal-dialog">
      <div class="modal-content">
		 <form id="f_buscar_subcuentas" name="f_buscar_subcuentas">
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               <h4 class="modal-title">Buscar subcuentas</h4>
            </div>
            <div class="modal-body">
               <div class="form-group">
                  <input type="hidden" name="codejercicio"/>
                  <input class="form-control" type="text" name="query"/>
               </div>
               <div class="form-group">
                  <div id="subcuentas"></div>
               </div>
            </div>
            <div class="modal-footer">
               <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled=true;this.form.submit();" title="Buscar">
                   <span class="glyphicon glyphicon-search"></span>
                   &nbsp; Buscar
                </button>
            </div>
         </form>
      </div>
   </div>
</div>

{if condition="$fsc->tipo == 'cli' AND $fsc->subcuenta"}
<div class="well well-sm">
   <div>
      <a class="btn btn-sm btn-default" href="{$fsc->cliente->url()}">&laquo; Volver al cliente</a>
   </div>
   <h2 style="margin: 10px 0px 10px 0px;">
      En el ejercicio {$fsc->subcuenta_a->codejercicio},
      <a href="{$fsc->cliente->url()}">{$fsc->cliente->nombre}</a>
      tiene asignada la cuenta...
   </h2>
   <div class="table-responsive">
      <table class="table table-hover">
         <tr>
            <th align="left">Ejercicio</th>
            <th align="left">Subcuenta + Descripci贸n</th>
            <th align="right">Debe</th>
            <th align="right">Haber</th>
            <th align="right">Saldo</th>
         </tr>
         <tr>
            <td align="left">{$fsc->subcuenta->codejercicio}</td>
            <td align="left">
               <a href="{$fsc->subcuenta->url()}">{$fsc->subcuenta->codsubcuenta}</a>
               {$fsc->subcuenta->descripcion}
            </td>
            <td align="right">{$fsc->show_precio($fsc->subcuenta->debe)}</td>
            <td align="right">{$fsc->show_precio($fsc->subcuenta->haber)}</td>
            <td align="right">{$fsc->show_precio($fsc->subcuenta->saldo)}</td>
         </tr>
      </table>
   </div>
</div>

<div class="well well-sm">
   <h2 style="margin: 0px 0px 10px 0px;">
      Cambiarla por...
   </h2>
   <form name="f_change_subcuenta" action="{$fsc->url()}" method="post">
      <input type="hidden" name="cli" value="{$fsc->cliente->codcliente}"/>
      <input type="hidden" name="idsc" value="{$fsc->subcuenta->idsubcuenta}"/>
      <input type="hidden" name="idsc2" value="{$fsc->subcuenta->idsubcuenta}"/>
      <div class="table-responsive">
         <table class="table table-hover">
            <tr>
               <th align="left">Ejercicio</th>
               <th align="left">Subcuenta</th>
               <th align="left">Descripci贸n</th>
               <th align="right">Debe</th>
               <th align="right">Haber</th>
               <th align="right">Saldo</th>
            </tr>
            <tr>
               <td>
                  <input class="full form-control" type="text" name="codejercicio" value="{$fsc->subcuenta->codejercicio}" disabled="disabled"/>
               </td>
               <td>
                  <input id="codsubcuenta" class="full form-control" type="text" name="subcuenta" value="{$fsc->subcuenta->codsubcuenta}"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="descripcion" value="{$fsc->subcuenta->descripcion}" disabled="disabled"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="debe" value="{$fsc->subcuenta->debe}" disabled="disabled" style="text-align: right;"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="haber" value="{$fsc->subcuenta->haber}" disabled="disabled" style="text-align: right;"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="saldo" value="{$fsc->subcuenta->saldo}" disabled="disabled" style="text-align: right;"/>
               </td>
            </tr>
         </table>
      </div>
      <div style="text-align: right;">
         <input class="btn btn-sm btn-primary" type="submit" value="Guardar"/>
      </div>
   </form>
</div>
{elseif condition="$fsc->tipo == 'pro' AND $fsc->subcuenta"}
<div class="well well-sm">
   <div>
      <a class="btn btn-sm btn-default" href="{$fsc->proveedor->url()}">&laquo; Volver al proveedor</a>
   </div>
   <h2 style="margin: 10px 0px 10px 0px;">
      En el ejercicio {$fsc->subcuenta_a->codejercicio},
      <a href="{$fsc->proveedor->url()}">{$fsc->proveedor->nombre}</a>
      tiene asignada la cuenta...
   </h2>
   <div class="table-responsive">
      <table class="table table-hover">
         <tr>
            <th align="left">Ejercicio</th>
            <th align="left">Subcuenta + Descripci贸n</th>
            <th align="right">Debe</th>
            <th align="right">Haber</th>
            <th align="right">Saldo</th>
         </tr>
         <tr>
            <td align="left">{$fsc->subcuenta->codejercicio}</td>
            <td align="left">
               <a href="{$fsc->subcuenta->url()}">{$fsc->subcuenta->codsubcuenta}</a>
               {$fsc->subcuenta->descripcion}
            </td>
            <td align="right">{$fsc->show_precio($fsc->subcuenta->debe)}</td>
            <td align="right">{$fsc->show_precio($fsc->subcuenta->haber)}</td>
            <td align="right">{$fsc->show_precio($fsc->subcuenta->saldo)}</td>
         </tr>
      </table>
   </div>
</div>

<div class="well well-sm">
   <h2 style="margin: 0px 0px 10px 0px;">
      Cambiarla por...
   </h2>
   <form name="f_change_subcuenta" action="{$fsc->url()}" method="post">
      <input type="hidden" name="pro" value="{$fsc->proveedor->codproveedor}"/>
      <input type="hidden" name="idsc" value="{$fsc->subcuenta->idsubcuenta}"/>
      <input type="hidden" name="idsc2" value="{$fsc->subcuenta->idsubcuenta}"/>
      <div class="table-responsive">
         <table class="table table-hover">
            <tr>
               <th align="left">Ejercicio</th>
               <th align="left">Subcuenta</th>
               <th align="left">Descripci贸n</th>
               <th align="right">Debe</th>
               <th align="right">Haber</th>
               <th align="right">Saldo</th>
            </tr>
            <tr>
               <td>
                  <input class="full form-control" type="text" name="codejercicio" value="{$fsc->subcuenta->codejercicio}" disabled="disabled"/>
               </td>
               <td>
                  <input id="codsubcuenta" class="full form-control" type="text" name="subcuenta" value="{$fsc->subcuenta->codsubcuenta}"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="descripcion" value="{$fsc->subcuenta->descripcion}" disabled="disabled"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="debe" value="{$fsc->subcuenta->debe}" disabled="disabled" style="text-align: right;"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="haber" value="{$fsc->subcuenta->haber}" disabled="disabled" style="text-align: right;"/>
               </td>
               <td>
                  <input class="full form-control" type="text" name="saldo" value="{$fsc->subcuenta->saldo}" disabled="disabled" style="text-align: right;"/>
               </td>
            </tr>
         </table>
      </div>
      <div style="text-align: right;">
         <input class="btn btn-sm btn-primary" type="submit" value="Guardar"/>
      </div>
   </form>
</div>
{else}
<div class="well well-sm" style="text-align: center;">
   <img src="view/img/fuuu_face.png" alt="fuuuuu"/>
</div>
{/if}

{include="footer"}
