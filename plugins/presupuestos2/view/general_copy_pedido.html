{include="header"}

<script type="text/javascript">
   function change_tipo_pedido()
   {
      if( $("#tipo_pedido").val() == 'cliente' )
      {
         $("#proveedores").hide();
         $("#clientes").show();
      }
      else
      {
         $("#clientes").hide();
         $("#proveedores").show();
      }
   }
   $(document).ready(function() {
      change_tipo_pedido();
   });
</script>

<div class="well well-sm">
   <form action="{$fsc->url()}" method="post">
      <input type="hidden" name="petition_id" value="{$fsc->random_string()}"/>
      <h3>
         Copiar a un nuevo...
         <span>
            <button class="btn btn-sm btn-primary" type="submit" value="Copiar" title="Copiar" onclick="this.disabled=true;this.form.submit();">
               <span class="glyphicon glyphicon-floppy-disk"></span>
               &nbsp; Copiar
            </button>
         </span>
      </h3>
      <select class="form-control" name="tipo" id="tipo_pedido" onchange="change_tipo_pedido()">
         <option value="cliente"{if condition="$fsc->tipo_pedido=='cliente'"} selected="selected"{/if}>{$pedido} de cliente</option>
         <option value="proveedor"{if condition="$fsc->tipo_pedido=='proveedor'"} selected="selected"{/if}>{$pedido} de proveedor</option>
      </select>
      <div class="form-group" id="clientes">
         de
         <select class="form-control" name="cliente">
         {loop="$fsc->cliente->all_full()"}
            {if condition="$fsc->tipo_pedido=='cliente'"}
               {if condition="$value->codcliente==$fsc->pedido->codcliente"}
               <option value="{$value->codcliente}" selected="selected">{$value->nombre}</option>
               {else}
               <option value="{$value->codcliente}">{$value->nombre}</option>
               {/if}
            {else}
            <option value="{$value->codcliente}">{$value->nombre}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div class="form-group" id="proveedores">
         de
         <select class="form-control" name="proveedor">
         {loop="$fsc->proveedor->all_full()"}
            {if condition="$fsc->tipo_pedido=='proveedor'"}
               {if condition="$value->codproveedor==$fsc->pedido->codproveedor"}
               <option value="{$value->codproveedor}" selected="selected">{$value->nombre}</option>
               {else}
               <option value="{$value->codproveedor}">{$value->nombre}</option>
               {/if}
            {else}
            <option value="{$value->codproveedor}">{$value->nombre}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div class="form-group">
         con fecha
         <input class="form-control datepicker" type="text" name="fecha" value="{$fsc->today()}" size="10" autocomplete="off"/>
         y hora
         <input type="text" name="hora" value="{$fsc->hour()}" size="8" autocomplete="off"/>
      </div>
      <div class="form-group">
         desde el almacén
         <select class="form-control" name="almacen">
         {loop="$fsc->almacen->all()"}
            {if condition="$value->codalmacen==$fsc->pedido->codalmacen"}
               <option value="{$value->codalmacen}" selected='selected'>{$value->nombre}</option>
            {else}
               <option value="{$value->codalmacen}">{$value->nombre}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div class="form-group">
         pertenece a la serie
         <select class="form-control" name="serie">
         {loop="$fsc->serie->all()"}
            {if condition="$value->codserie==$fsc->pedido->codserie"}
               <option value="{$value->codserie}" selected='selected'>{$value->descripcion}</option>
            {else}
               <option value="{$value->codserie}">{$value->descripcion}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div class="form-group">
         forma de pago
         <select class="form-control" name="forma_pago">
         {loop="$fsc->forma_pago->all()"}
            {if condition="$value->codpago==$fsc->pedido->codpago"}
               <option value="{$value->codpago}" selected="selected">{$value->descripcion}</option>
            {else}
               <option value="{$value->codpago}">{$value->descripcion}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div class="form-group">
         divisa
         <select class="form-control" name="divisa">
         {loop="$fsc->divisa->all()"}
            {if condition="$value->coddivisa==$fsc->pedido->coddivisa"}
               <option value="{$value->coddivisa}" selected="selected">{$value->descripcion}</option>
            {else}
               <option value="{$value->coddivisa}">{$value->descripcion}</option>
            {/if}
         {/loop}
         </select>
      </div>
      <div>
         observaciones:
         <textarea name="observaciones" cols="50">Copia del {$pedido} de {$fsc->tipo_pedido} {$fsc->pedido->codigo}</textarea>
      </div>
   </form>
</div>

<div class="well well-sm">
   <div class="table-responsive">
      <table class="table table-hover">
         <tr>
            <th align="left">Artículo</th>
            <th align="right">Cantidad</th>
            <th align="right">PVP</th>
            <th align="right">Dto</th>
            <th align="right">Total</th>
            <th align="right">IVA</th>
            <th align="right">Total+IVA</th>
         </tr>
         {loop="$fsc->pedido->get_lineas()"}
         <tr>
            <td><a href="{$value->articulo_url()}">{$value->referencia}</a> {$value->descripcion}</td>
            <td align="right">{$value->cantidad}</td>
            <td align="right">{$fsc->show_precio($value->pvpunitario, $fsc->pedido->coddivisa)}</td>
            <td align="right">{$fsc->show_numero($value->dtopor, 2)} %</td>
            <td align="right">{$fsc->show_precio($value->pvptotal, $fsc->pedido->coddivisa)}</td>
            <td align="right">{$fsc->show_numero($value->iva, 2)} %</td>
            <td align="right">{$fsc->show_precio($value->total_iva(), $fsc->pedido->coddivisa)}</td>
         </tr>
         {/loop}
      </table>
   </div>
   <br/><br/>
   <div class="table-responsive">
      <table class="table table-hover">
         <tr>
            <td><b>Neto:</b> {$fsc->show_precio($fsc->pedido->neto, $fsc->pedido->coddivisa)}</td>
            <td align="center"><b>IVA:</b> {$fsc->show_precio($fsc->pedido->totaliva, $fsc->pedido->coddivisa)}</td>
            <td align="right"><b>Total:</b> {$fsc->show_precio($fsc->pedido->total, $fsc->pedido->coddivisa)}</td>
         </tr>
      </table>
   </div>
</div>

{include="footer"}
