{*
/*
   Plugin Fabricantes para FacturaSctipts
   (c) 2014 JHircano@gmail.com
   -----------------------------------------------------------------------------------------

 * This file is part of FacturaSctipts
 * Copyright (C) 2014  Carlos Garcia Gomez  neorazorx@gmail.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
*}

{include="header"}

<script type="text/javascript">
   function delete_fabricante(url)
   {
      if( confirm("¿Realmente desea eliminar este Fabricante?") )
         window.location.href = url;
   }

   $(document).ready(function() {
      document.f_custom_search.query.focus();
      {* Abre ventana modal para nuevo fabricante *}
      $("#b_nuevo_fabricante").click(function(event) {
         event.preventDefault();
         $("#modal_nuevo_fabricante").modal('show');
         
         // Clean form: set input fields to default values
         // Es necesario hacerlo cuando $fsc->fabricante->codfabricante no es nulo y se intenta crear un fabricante nuevo.
         // Esto sucede cuando se selecciona un fabricante para modificar, pero se cierra la ventana modal pulsando el aspa de cerrar la ventana
         $("#nombre").val("");
         $("#descripcion").val("");
         $("#valoracion option")
            .each(function() { this.selected = (this.text == 0); });
         $("#fecha_alta").val("{$fsc->today()}");
         $("#activo").prop("checked", false);

         // $(':input',"#f_nuevo_fabricante")
         //    .not(':button, :submit, :reset, :hidden')
         //    .val('')
         //    .removeAttr('checked')
         //    .removeAttr('selected');
         // $("#f_nuevo_fabricante").get(0).reset();
         
         document.f_nuevo_fabricante.nombre.focus();
      });


      {* Recupera verntana modal para nuevo fabricante cuando hay errores en los datos de entrada *}
      {if condition="$fsc->action=='nuevo'"}

         // $("#modal_ver_fabricante").click(function(event) {
         // event.preventDefault();
         // });
         $("#modal_nuevo_fabricante").modal('show');
         document.f_nuevo_fabricante.nombre.focus();

      {/if}

      {* Abre ventana modal para ver / modificar fabricante *}
      {if condition="$fsc->fabricante->codfabricante"}

         // $("#modal_ver_fabricante").click(function(event) {
         // event.preventDefault();
         // });
         $("#modal_ver_fabricante").modal('show');
         document.f_ver_fabricante.nombre.focus();

      {/if}

   });
</script>


<form class="form" id="f_nuevo_fabricante" name="f_nuevo_fabricante" action="index.php?page=fabricantes" method="post">
   <div class="modal" id="modal_nuevo_fabricante">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               <h4 class="modal-title">Nuevo Fabricante</h4>
            </div>

   {if condition="$fsc->get_errors()"}
   <div class="alert alert-danger hidden-print">
      <ul>{loop="$fsc->get_errors()"}<li>{$value}</li>{/loop}</ul>
   </div>
   {/if}
            <div class="modal-body">
               <div class="form-group">
                  Código:
                  <input class="form-control" type="text" name="codfabricante" value="Automático" disabled="disabled" />
               </div>
               <div class="form-group">
                  Nombre:
                  <input class="form-control" type="text" id="nombre" name="nombre" value="{$fsc->fabricante->nombre}" size="64" autocomplete="off"/>
               </div>
               <div class="form-group">
                  Descripción:
                  <textarea class="form-control" rows="3" id="descripcion" name="descripcion">{$fsc->fabricante->descripcion}</textarea>
               </div>
               <div class="form-group">
                  Valoración:
                  <select class="form-control" id="valoracion" name="valoracion">
                      <option {if condition="$fsc->fabricante->valoracion==0"}selected="selected"{/if} value="0">&nbsp; 0 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==1"}selected="selected"{/if} value="1">&nbsp; 1 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==2"}selected="selected"{/if} value="2">&nbsp; 2 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==3"}selected="selected"{/if} value="3">&nbsp; 3 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==4"}selected="selected"{/if} value="4">&nbsp; 4 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==5"}selected="selected"{/if} value="5">&nbsp; 5 &nbsp;</option>
                  </select>
               </div>
               <div class="form-group">
                  Fecha de Alta:
                  <input class="form-control datepicker" type="text" id="fecha_alta" name="fecha_alta" value="{if condition="$fsc->fabricante->fecha_alta"}{$fsc->fabricante->fecha_alta}{else}{$fsc->today()}{/if}" size="10" autocomplete="off"/>
               </div>
               <div class="form-group">
                  Activo:
                  <label>
                      <input type="checkbox" value="TRUE" id="activo" name="activo" {if condition="$fsc->fabricante->activo"}checked="checked"{/if}>

                  </label>
               </div>
            </div>
            <div class="modal-footer">
               <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled=true;this.form.submit();">
                  <span class="glyphicon glyphicon-floppy-disk"></span>
                  &nbsp; Guardar
               </button>
               <input type="hidden" name="submitFabricantes" value="submitFabricantes"/>
            </div>
         </div>
      </div>
   </div>
</form>



<form class="form" name="f_ver_fabricante" action="index.php?page=fabricantes" method="post">
   <div class="modal" id="modal_ver_fabricante">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               <h4 class="modal-title">Fabricante</h4>
            </div>

   {if condition="$fsc->get_errors()"}
   <div class="alert alert-danger hidden-print">
      <ul>{loop="$fsc->get_errors()"}<li>{$value}</li>{/loop}</ul>
   </div>
   {/if}
            <div class="modal-body">
               <div class="form-group">
                  Código:
                  <input class="form-control" type="text" name="codfabricante_" value="{$fsc->fabricante->codfabricante}" disabled="disabled" />
                  <input type="hidden" name="codfabricante" value="{$fsc->fabricante->codfabricante}" />
               </div>
               <div class="form-group">
                  Nombre:
                  <input class="form-control" type="text" name="nombre" value="{$fsc->fabricante->nombre}" size="64" autocomplete="off"/>
               </div>
               <div class="form-group">
                  Descripción:
                  <textarea class="form-control" rows="3" name="descripcion">{$fsc->fabricante->descripcion}</textarea>
               </div>
               <div class="form-group">
                  Valoración:
                  <select class="form-control" name="valoracion">
                      <option {if condition="$fsc->fabricante->valoracion==0"}selected="selected"{/if} value="0">&nbsp; 0 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==1"}selected="selected"{/if} value="1">&nbsp; 1 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==2"}selected="selected"{/if} value="2">&nbsp; 2 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==3"}selected="selected"{/if} value="3">&nbsp; 3 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==4"}selected="selected"{/if} value="4">&nbsp; 4 &nbsp;</option>
                      <option {if condition="$fsc->fabricante->valoracion==5"}selected="selected"{/if} value="5">&nbsp; 5 &nbsp;</option>
                  </select>
               </div>
               <div class="form-group">
                  Fecha de Alta:
                  <input class="form-control datepicker" type="text" name="fecha_alta" value="{$fsc->fabricante->fecha_alta}" size="10" autocomplete="off"/>
               </div>
               <div class="form-group">
                  Activo:
                  <label>
                      <input type="checkbox" value="TRUE" name="activo" {if condition="$fsc->fabricante->activo"}checked="checked"{/if}>

                  </label>
               </div>
            </div>
            <div class="modal-footer">
               <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled=true;this.form.submit();">
                  <span class="glyphicon glyphicon-floppy-disk"></span>
                  &nbsp; Guardar
               </button>
               <input type="hidden" name="submitFabricantes" value="submitFabricantes"/>
            </div>
         </div>
      </div>
   </div>
</form>



<div class="table-responsive">
   <table class="table table-hover">
      <thead>
         <tr>
            <th class="text-left">Código + Nombre</th>
            <th class="text-left">Descripción</th>
            <th class="text-left">Valoración</th>
            <th class="text-right">Activo</th>
            <th class="text-center">Fecha alta</th>
            <th class="text-right" width="140">Acciones</th>
         </tr>
      </thead>
      {loop="$fsc->listar_fabricantes()"}
      <tr>
         <td>
            <a href="index.php?page=fabricantes&codfabricante={$value->codfabricante}">{$value->codfabricante}</a> {$value->nombre}
         </td>
         <td>{$value->descripcion}</td>
         <td>{$value->valoracion}</td>
         <td class="text-right">
            {if condition="$value->activo"}
                  <a href="index.php?page=fabricantes&cestado={$value->codfabricante}" class="btn btn-sm btn-success" title="Click para Desactivar">
                     <span class="glyphicon glyphicon-ok"></span>
                  </a>
            {else}
                  <a href="index.php?page=fabricantes&cestado={$value->codfabricante}" class="btn btn-sm btn-danger" title="Click para Activar">
                     <span class="glyphicon glyphicon-remove"></span>
                  </a>
            {/if}
         </td>
         <td class="text-center">{$value->fecha_alta}</td>

         <td class="text-right">
               <div class="btn-group">
                  <a class="btn btn-sm btn-danger" onclick="delete_fabricante('index.php?page=fabricantes&delete={$value->codfabricante}')" title="Eliminar">
                     <span class="glyphicon glyphicon-trash"></span>
                  </a>

                  <a class="btn btn-sm btn-primary" href="index.php?page=fabricantes&codfabricante={$value->codfabricante}" title="Modificar">
                    <span class="glyphicon glyphicon-floppy-disk">
                  </a>
               </div>
         </td>

      </tr>
        {else}
        <tr>
            <td colspan="6">Ningún fabricante encontrado. Pulsa el botón <b>Nuevo</b> para crear uno.</td>
        </tr>
      {/loop}
   </table>

   {if condition="$fsc->get_errors()"}
   {* Si fsc->listar_fabricantes() produce un error, éste no aparece en la cabecera de la página, y por eso ponemos este contenedor *}
   <div class="alert alert-danger hidden-print">
      <ul>{loop="$fsc->get_errors()"}<li>{$value}</li>{/loop}</ul>
   </div>
   {/if}
</div>

<!-- 
codfabricante` int(10) unsigned NOT NULL,
  `nombre` varchar(64) COLLATE utf8_bin NOT NULL,
  `descripcion` text COLLATE utf8_bin,
  `valoracion` tinyint(1) DEFAULT NULL,
  `fecha_alta` datetime DEFAULT NULL,
  `activo
-->

{include="footer"}